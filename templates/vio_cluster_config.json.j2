{
  "name" : "{{ vio_cluster_name }}",
  "nodeGroups" : [ {
    "name" : "LoadBalancer",
    "role" : "LoadBalancer",
    "instanceNum" : 2,
    "cpuNum" : 2,
    "memCapacityMB" : 4096,
    "swapRatio" : 1.0,
    "haFlag" : "on",
    "attributes" : {
      "public_vip" : "{{ vio_loadbalancer_vip | ipaddr }}",
      "public_hostname" : "{{ vio_loadbalancer_hostname }}"
    }
  }, {
    "name" : "Controller",
    "role" : "Controller",
    "instanceNum" : 2,
    "cpuNum" : 8,
    "memCapacityMB" : 16384,
    "swapRatio" : 1.0,
    "haFlag" : "on",
    "attributes" : {
      "syslog_server" : "{{ syslog_server | ipaddr }}",
      "syslog_server_protocol": "{{ vio_oms_syslog_protocol }}",
      "syslog_server_port": "{{ vio_oms_syslog_port }}",
      "syslog_server_tag": "{{ vio_cluster_name }}",
      "vcenter_user" : "{{ vio_oms_vcenter_username }}",
      "token_expiration_time" : "7200",
      "nsxv_vdn_scope_moref" : "{{ item.vdnscopeid }}",
      "vcenter_password" : "{{ vio_oms_vcenter_pwd }}",
      "nsxv_dvs_moref" : "{{ item.vdsmoid }}",
      "cinder_folder" : "Volumes",
      "nsxv_external_network_moref" : "{{ vio_nsx_external_network }}",
      "vcenter_insecure" : "true",
      "glance_datastores" : "{{ vio_oms_datacenter_name }}:{{ vio_glance_datastore }}:100",
      "nsxv_edge_cluster_moref" : "{{ item.edgeid }}",
      "neutron_backend" : "nsxv",
      "nsxv_username" : "{{ vio_nsx_manager_username }}",
      "vcenter_ip" : "{{ vio_oms_vcenter_hostname }}",
      "glance_folder" : "/images",
      "nsxv_manager" : "{{ vio_nsx_manager_ip }}",
      "nsxv_edge_cluster_name" : "{{ vio_nsx_edge_cluster }}",
      "admin_tenant_name" : "admin",
      "nsxv_password" : "{{ vio_nsx_manager_password }}",
      "admin_tenant_name": "admin",
{% if vio_use_ad == '1' and vio_use_keystone == '0' %}
      "admin_password": "{{ vio_authentication_ad_admin_user_password }}",
      "admin_user": "{{ vio_authentication_ad_admin_user }}",
      "ldap_password": "{{ vio_authentication_ad_bind_user_password }}",
      "ldap_group_member_attribute": "{{ vio_authentication_ad_ldap_group_member_attribute }}",
      "ldap_user_filter": "{{ vio_authentication_ad_ldap_user_filter}}",
      "keystone_backend": "ldap",
      "ldap_user_mail_attribute": "{{ vio_authentication_ad_ldap_user_mail_attribute }}",
      "ldap_group_tree_dn": "{{ vio_authentication_ad_ldap_group_tree_dn }}",
      "ldap_user_tree_dn": "{{ vio_authentication_ad_ldap_user_tree_dn }}",
      "ldap_user_pass_attribute": "{{ vio_authentication_ad_ldap_user_pass_attribute }}",
      "ldap_group_desc_attribute": "{{ vio_authentication_ad_ldap_group_desc_attribute }}",
      "ldap_group_objectclass": "{{ vio_authentication_ad_ldap_group_objectclass }}",
      "ldap_group_id_attribute": "{{ vio_authentication_ad_ldap_group_id_attribute }}",
      "ldap_group_name_attribute": "{{ vio_authentication_ad_ldap_group_name_attribute }}",
      "ldap_user_id_attribute": "{{ vio_authentication_ad_ldap_user_id_attribute }}",
      "ldap_user": "{{ vio_authentication_ad_bind_user }}",
      "ldap_group_filter": "{{ vio_authentication_ad_ldap_group_filter }}",
      "ldap_user_objectclass": "{{ vio_authentication_ad_ldap_user_objectclass }}",
      "ldap_user_name_attribute": "{{ vio_authentication_ad_ldap_user_name_attribute }}",
{% if vio_authentication_ad_encryption != 'StartTLS' %}
      "ldap_use_tls": false,
{% else %}
      "ldap_use_tls": true,
{% endif %}
{% set prefix = 'ldap' %}
{% if vio_authentication_ad_encryption == 'SSL' %}
{% set vio_authentication_ad_port = 636 %}
{% set prefix = 'ldaps' %}
{% else %}
{% set vio_authentication_ad_port = 389 %}
      "ldap_url": "{{ prefix }}://{{ vio_authentication_ad_dc_hostname }}:{{ vio_authentication_ad_port }}"
{% endif %}
{% else %}
      "admin_password": "{{ vio_authentication_keystone_password }}",
      "admin_user": "{{ vio_authentication_keystone_username }}",
      "keystone_backend": "sql"
{% endif %}
    }
  }, {
    "name" : "DB",
    "role" : "Database",
    "instanceNum" : 3,
    "cpuNum" : 4,
    "memCapacityMB" : 16384,
    "swapRatio" : 1.0,
    "haFlag" : "on"
  }, {
    "name" : "RabbitMQ",
    "role" : "MessageQueue",
    "instanceNum" : 2,
    "cpuNum" : 4,
    "memCapacityMB" : 16384,
    "swapRatio" : 1.0,
    "haFlag" : "on"
  }, {
    "name" : "ObjectStorage",
    "role" : "ObjectStorage",
    "instanceNum" : 1,
    "cpuNum" : 2,
    "memCapacityMB" : 4096,
    "swapRatio" : 1.0,
    "haFlag" : "on"
  }, {
    "name" : "Memcache",
    "role" : "MemoryCache",
    "instanceNum" : 2,
    "cpuNum" : 2,
    "memCapacityMB" : 16384,
    "swapRatio" : 1.0,
    "haFlag" : "on"
  }, {
    "name" : "ComputeDriver",
    "role" : "Compute",
    "instanceNum" : 1,
    "cpuNum" : 2,
    "memCapacityMB" : 4096,
    "swapRatio" : 1.0,
    "haFlag" : "on",
    "attributes" : {
      "region_name" : "nova"
    },
    "nodeAttributes" : [ {
      "cluster_name" : "{{ vio_nova_cluster }}",
      "datastore_regex" : "{{ vio_nova_datastore }}",
      "cluster_moid" : "{{ item.computeid }}"
    } ]
  } ],
  "vcClusters" : [ {
    "name" : "{{ vio_management_cluster }}",
    "moid" : "{{ item.managementid }}"
  } ],
  "networkConfig" : {
    "DATA_NETWORK" : [ "{{ vio_management_network_portgroup }}" ],
    "EXTERNAL_NETWORK" : [ "{{ vio_management_openstack_api_network_portgroup }}" ],
    "METADATA_NETWORK" : [ "{{ vio_management_network_portgroup }}" ],
    "MGT_NETWORK" : [ "{{ vio_management_network_portgroup }}" ],
    "REPL_NETWORK" : [ "{{ vio_management_network_portgroup }}" ]
  },
  "networkings" : [ {
    "name" : "{{ vio_management_openstack_api_network_portgroup }}",
    "portGroup" : "{{ vio_management_openstack_api_network_portgroup }}",
    "isDhcp" : false,
    "type" : "static",
    "dns1" : "{{ dns_server | ipaddr }}",
    "ipBlocks" : [ {
      "beginIp" : "{{ vio_management_openstack_api_network_ip_start | ipaddr }}",
      "endIp" : "{{ vio_management_openstack_api_network_ip_end | ipaddr }}"
    } ],
    "gateway" : "{{ vio_management_openstack_api_network_gateway | ipaddr }}",
    "netmask" : "{{ vio_management_openstack_api_network_subnet | ipaddr }}",
    "dnsList" : [ "{{ dns_server | ipaddr }}" ]
  }, {
    "name" : "{{ vio_management_network_portgroup }}",
    "portGroup" : "{{ vio_management_network_portgroup }}",
    "isDhcp" : false,
    "type" : "static",
    "dns1" : "{{ dns_server | ipaddr }}",
    "ipBlocks" : [ {
      "beginIp" : "{{ vio_management_network_ip_start | ipaddr }}",
      "endIp" : "{{ vio_management_network_ip_end | ipaddr }}"
    } ],
    "gateway" : "{{ vio_management_network_gateway | ipaddr }}",
    "netmask" : "{{ vio_management_network_subnet | ipaddr }}",
    "dnsList" : [ "{{ dns_server | ipaddr }}" ]
  } ],
  "specFile" : true,
  "attributes" : {
     "plan": ""
  }
}
